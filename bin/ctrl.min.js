(function(){var n,t,r,e,u,l,a=function(n,t){return function(){return n.apply(t,arguments)}};t=function(n){return Array.prototype.slice.call(n)},u=function(n){return null!=n&&Array.isArray(n)},l={next:function(n,r){var e;return n.steps=t(n.steps),e=-1,n.next=function(){var r;return e++,r=[n].concat(t(arguments)),e>=n.steps.length?n.callback(r):n.steps[e].apply(null,r)},r()},spawn:function(n,r){var e,u,l;return l=null,e=function(){function n(n,t){this.callback=t,this.spawn=a(this.spawn,this),this.threadCount=-1,this.returnedThreads=-1,this.returnValues={}}return n.prototype.spawn=function(){var n,r=this;return this.threadCount++,n=this.threadCount,function(){if(null!=r.returnValues[n])throw"A spawn's callback can not be called multiple times!";return r.returnValues[n]=function(){switch(arguments.length){case 0:return null;case 1:return arguments[0];default:return t(arguments)}}.apply(r,arguments),r.returnedThreads++,r.checkIfAllReturned()}},n.prototype.checkIfAllReturned=function(){return this.returnValues.length&&this.returnedThreads===this.threadCount?(this.callback.apply(null,t(this.returnValues)),l=null):void 0},n.prototype.doneSpawning=function(){return this.returnValues.length=this.threadCount+1,this.checkIfAllReturned()},n}(),u=n.next,n.spawn=function(){return l||(l=new e(n,u)),l.spawn()},n.next=function(){return null===l?u.apply(null,arguments):l.doneSpawning()},r()},errorHandler:function(n,t){var r;return n.options.errorHandler?(r=n.next,n.next=function(){try{return r.apply(null,arguments)}catch(t){return n.options.errorHandler(n,t)}},t()):(t(),void 0)},data:function(n,t){return n.data=null!=n.options.data?n.options.data:{},t()}},n=function(){function n(n){this.modules=n,this.run=a(this.run,this),u(this.modules)||(this.modules=t(arguments))}return n.prototype.run=function(n,r,e){var u,a,s;return null==r&&(r={}),null==e&&(e=function(){}),u={steps:n,options:r,callback:e},l=t(this.modules),a=-1,s=function(){return a++,a>=l.length?u.next():l[a](u,s)},s()},n}(),r=new n(l.next,l.spawn,l.data,l.errorHandler),e=r.run,e.modules=l,e.defaultCtrlRunner=r,e.CtrlRunner=n,"undefined"==typeof module?window.ctrl=e:module.exports=e}).call(this);